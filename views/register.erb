<%
  @page_class = "register"
  @page_title = "Register"
%>

<%= partial :_header_banner %>

<section class="grid ballot-info" role="main">
  <% if @errors %>
    <div class="errors">
      <h1>Oh snap! Something isn't quite right</h1>
      <p>There was an error with your details. Give it another go.</p>
      <ol>
        <% for message in @errors.full_messages %>
          <li><%= message %></li>
        <% end %>
      </ol>
    </div>
  <% else %>
    <h1>Enter the Bunk Ballot</h1>

    <p>Bunks are available to attendees on a ballot basis.</p>

    <p>To enter the ballot, fill your personal and payment details in below. Your details will be stored securely by pin.net.au.</p>

    <p>We'll randomly allocate the available tickets after the ballot is closed. Successful railscampers will be charged at that time and notified.  </p>

    <p>If you're unsuccessful, you won't be charged, Pin will conveniently forget your payment details, and we'll email you the bad news.</p>

    <p>You have until <strong>midnight (AEST) on Monday April 14</strong> to enter the ballot.</p>

    <h1>Take a Tent Ticket</h1>

    <% if @tents_available %>
    <p>You can bring your own tent and bedding to camp, and your ticket will be allocated immediately upon registration.</p>

    <p>Once they're all allocated that's it!  No more tent tickets are available.  You'll be charged safely and securely by pin.net.au when the Bunk Ballot concludes.</p>
    <% else %>
    <p>Tent tickets are sold out!  Sorry, you'll have to try your luck in the bunk ballot.</p>
    <% end %>

    <p>This year we're also offering a number of scholarship tickets.
    <a href="/scholarship" class="button alternate-entry-button">Apply for a scholarship</a></p>

    <p>All entrants agree to abide by the <a class='coc' href="http://ruby.org.au/code-of-conduct.html" target="_blank">Code of Conduct</a>, backed up by our friendly and easily accessed team of organizers.</p>
  <% end %>

  <form method="post">
    <div class="ticket-info">
      <div class="price">Max $250</div>
      <div class="price-buys">Includes accomodation &amp; meals</div>
    </div>

    <%= partial :_form_common %>

    <h2>Card details</h2>

    <fieldset>
      <label for="cc-name">Name on card</label>
      <input id="cc-name" name='entrant[cc_name]' required autocompletetype="cc-name" format=".+\s.+" pattern=".+\s.+" data-pin="name">
    </fieldset>

    <fieldset>
      <label for="cc-number">Credit card number</label>
      <input id="cc-number" type="text" autocompletetype="cc-number" format="\d{15,16}" pattern="\d{15,16}" placeholder="4242424242424242" required data-pin="number">
    </fieldset>

    <fieldset>
      <label for="cc-expiry">Expiry (MM/YYYY)</label>
      <input id="cc-expiry" type="text" autocompletetype="cc-expiry" format="\d{2}/(\d{2}|\d{4})" pattern="\d{2}/(\d{2}|\d{4})" placeholder="01/2020" required data-pin="expiry">
    </fieldset>

    <fieldset>
      <label for="cc-cvc">CVC</label>
      <input id="cc-cvc" type="text" autocompletetype="cc-csc" placeholder="123" required autocomplete="off" data-pin="cvc">
    </fieldset>

    <fieldset>
      <label for="cc-address">Address</label>
      <input id="cc-address" name='entrant[cc_address]' required autocompletetype="street-address" data-pin="address_line1">
    </fieldset>

    <fieldset>
      <label for="cc-city">City</label>
      <input id="cc-city" name='entrant[cc_city]' required autocompletetype="city" data-pin="address_city">
    </fieldset>

    <fieldset>
      <label for="cc-postcode">Postcode</label>
      <input id="cc-postcode" name='entrant[cc_post_code]' required autocompletetype="postal-code" data-pin="address_postcode">
    </fieldset>

    <fieldset>
      <label for="cc-state">State</label>
      <input id="cc-state" name='entrant[cc_state]' required autocompletetype="state" data-pin="address_state">
    </fieldset>

    <fieldset>
      <label for="cc-country">Country</label>
      <input id="cc-country" name='entrant[cc_country]' required autocompletetype="country-name" data-pin="address_country">
    </fieldset>

    <fieldset class="registration">
      <div class="registration-agreement">
        This card will be billed at most $250,<br>
        <em>only</em> if you receive a ticket.
      </div>
      <button class="register-button" data-busy-text="Hold tight...">Go Go Go!</button>
    </fieldset>
  </form>
</section>

<footer role="contentinfo">
  <div class="sponsor grid pin">
    Generously sponsored by <a href="https://pin.net.au/"><img src="/images/pin.svg" alt="Pin Payments"></a>
  </div>
</footer>
